---
layout: default
---
<div class="home">
  <header class="home-header">
    <h1>{{ site.title | default: "Blog" }}</h1>
  </header>

  {% assign lines = content | split: "\n" %}
  {% assign items = '' | split: '' %}
  {% for line in lines %}
    {% assign trimmed = line | strip %}
    {% if trimmed contains '[' and trimmed contains '](' %}
      {% assign items = items | push: trimmed %}
    {% endif %}
  {% endfor %}

  {%- comment -%}
  Build a map year -> array of items. Year is extracted from link title.
  Title examples: [2024-09-01 My Post](...) or [2023 Some Title](...)
  We'll parse digits at start (4-digit year) or first 4-digit number in title.
  {%- endcomment -%}

  {% assign grouped = '{}' | split: '' %}
  {% assign years = '' | split: '' %}

  {% assign item_year_pairs = '' | split: '' %}
  {% for item in items %}
    {%- assign title_part = item | split: ']' | first | remove: '[' -%}
    {%- assign year = '' -%}
    {%- if title_part.size >= 4 and title_part | slice: 0,4 | plus: 0 -%}
      {%- assign year_candidate = title_part | slice: 0,4 -%}
      {%- if year_candidate >= '1900' and year_candidate <= '2100' -%}
        {%- assign year = year_candidate -%}
      {%- endif -%}
    {%- endif -%}
    {%- if year == '' -%}
      {%- comment -%} find first 4-digit number anywhere {%- endcomment -%}
      {%- assign parts = title_part | split: ' ' -%}
      {%- for p in parts -%}
        {%- if p.size >= 4 -%}
          {%- assign y = p | slice: 0,4 -%}
          {%- if y >= '1900' and y <= '2100' -%}
            {%- assign year = y -%}
            {%- break -%}
          {%- endif -%}
        {%- endif -%}
      {%- endfor -%}
    {%- endif -%}
    {%- if year == '' -%}
      {%- assign year = 'Other' -%}
    {%- endif -%}
    {%- assign item_year_pairs = item_year_pairs | push: year | push: item -%}
  {% endfor %}

  {%- comment -%}
  Collect unique years in order of first appearance
  {%- endcomment -%}
  {% assign seen = '' | split: '' %}
  {% for i in (0..item_year_pairs.size) %}
    {% if (i | modulo: 2) == 0 and i < item_year_pairs.size %}
      {% assign y = item_year_pairs[i] %}
      {% unless seen contains y %}
        {% assign seen = seen | push: y %}
      {% endunless %}
    {% endif %}
  {% endfor %}
  {% assign years = seen %}

  <nav class="year-nav" style="margin: 16px 0; display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
    <div>
      {% for y in years %}
        {% if y != 'Other' %}
          <a href="/years/{{ y }}.html" style="margin-right: 12px;">{{ y }}</a>
        {% endif %}
      {% endfor %}
    </div>
    <button id="order-toggle" type="button" style="padding: 4px 10px;">切换为顺序</button>
  </nav>

  {%- comment -%}
  Render sections per year, preserving original order within each year (client JS may reverse)
  {%- endcomment -%}
  {% for y in years %}
    <section id="year-{{ y }}" style="margin-top: 24px;">
      <h2>{{ y }}</h2>
      <ul class="post-list" data-year="{{ y }}">
        {% for j in (0..item_year_pairs.size) %}
          {% if (j | modulo: 2) == 1 and j < item_year_pairs.size %}
            {% assign item = item_year_pairs[j] %}
            {% assign item_y = item_year_pairs[j | minus: 1] %}
            {% if item_y == y %}
              <li>{{ item | markdownify | strip }}</li>
            {% endif %}
          {% endif %}
        {% endfor %}
      </ul>
    </section>
  {% endfor %}
</div>

<script>
(function() {
  function getParam(name) {
    const m = new RegExp('[?&]'+name+'=([^&#]*)').exec(location.search);
    return m ? decodeURIComponent(m[1].replace(/\+/g, ' ')) : null;
  }
  function reverseUl(ul) {
    const items = Array.from(ul.children);
    for (let i = items.length - 1; i >= 0; i--) {
      ul.appendChild(items[i]);
    }
  }
  function applyOrder(order) {
    document.querySelectorAll('ul.post-list').forEach(function(ul) {
      const original = ul.getAttribute('data-original');
      if (!original) {
        ul.setAttribute('data-original', ul.innerHTML);
      } else if (order === 'asc') {
        ul.innerHTML = original;
      }
      if (order === 'desc') {
        // ensure we are in ascending first, then reverse to descending
        if (ul.getAttribute('data-original')) {
          ul.innerHTML = ul.getAttribute('data-original');
        }
        reverseUl(ul);
      }
    });
    const btn = document.getElementById('order-toggle');
    if (btn) {
      btn.textContent = order === 'desc' ? '切换为顺序' : '切换为倒序';
    }
  }

  var order = getParam('order') || localStorage.getItem('orderPreference') || 'desc';
  if (order !== 'asc' && order !== 'desc') order = 'desc';
  applyOrder(order);

  var btn = document.getElementById('order-toggle');
  if (btn) {
    btn.addEventListener('click', function() {
      order = (order === 'desc') ? 'asc' : 'desc';
      localStorage.setItem('orderPreference', order);
      const url = new URL(location.href);
      url.searchParams.set('order', order);
      history.replaceState(null, '', url.toString());
      applyOrder(order);
    });
  }
})();
</script> 